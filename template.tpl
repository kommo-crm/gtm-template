___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Kommo Website chat button",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAW0SURBVHgB7Z1PaBxVHMd/M6lFazAxRFqUhK259NZNjrXQ7R/itXgskm6hB1FoCmrwZBpPUhFqD54KJh68Kb0atI6QXrvJqR4MLA1ogqFdpY1Ym0zf9+1O2CSbzMyb3febmfw+sGQ3zLLw+775/t7v997ucygm5VKltOG6pxzHL6qXePQ2HvsTh+bJp5rj+7/SBnnT3rAX7+0RUEHvVUEfV0G/Svs52NGoKjGmGmJUwy4OFWDs7MK4Q/41ksDHRQsxfWd4eq+LdhVAjfqC3+V8o56WSEiC56z7l3a7G1oK0Aj+L+ppgYR2UFUinG4lwg4BGsGvkFhOu6kpEYa3i+A2v2ga+RL89tOL2CLGzf/cIkDD8wskdIogr26yKUD5TKVMknBtUFKxvhq80DlAkq51kA+OqnxQq98Brh75BRJs0atiru8CLYDvOJMkWEXFfBx/nfK5Ssn3tf0IlkFt4KqeRYkEHpT1u+pWOEUCDw4VkQOk6GLCJ+c4BCiSwEWvSwInIgA3IgAzIgAzIgAzIgAzIgAzB2ifcKi7iw693EX9Rw6GXvvbwmOyRa4FQNBPjr5KI2/10LHj3ZHf9/mHi9ZEyK0ACPjliQHqPxw+4ptZXXkqd0BSMOovTwySCRj9NsldEq6PfLPg3/52hVaXn5JNciUAEixsx4QHi/8qAZbJNrkS4PzY4dieD9aerNPNySpxkBsB4PsnR/vIhNsz9q0nIBcCwHrOXzxCJszNPqTZH/4iLnIhwIX3XzeyHkw5kXg5ybwAo+/008iJHjKB03oCMi1AUuvBg5tMC/DJl0O6vxMXWM93X/9BaSCzAphOOcGt60u09nid0kAmBdDWM2ZmPUi6Nns9YWROAHQ4YT0m1Gc99qvdvcicAEmsx3ajLQqZEmDkxCtq2vkamcDRaItCZgSA71/44A0ygavRFoXMCJDFRlsUMiFAkkbbvbt/p9J6AlIvQJJqF8x+v0ppJlVLkrCYY8VuVd26eroJsKBuOusB8P80kwoBtMW83Rdr50JUIGRaqt5WsAqglxA/HuhI4AMGh15KVeW7HbYcgOCjou1k8AFmT2mGTYArU4VE3h4VCIw8klZYBIDnwxqigP7NR+/ep/K5BWMrgc1F2ZLIAYsAcaaVcz8+3JzHo6AySahIxBAhjVgXAJZgaj0I/q0vlsgEfC6WL9OGdQEGh16kJKCyNd3FgDWEtFmRdQHaEQDd2VyJ315IoxVZFyCocJOgrei6uRWlaWqa2TVhzIiSWFHUWVinyfSuCFMrAlc+K7TlbkxKpgWAFd38tEomYCaWBivK/M44dDtN9/hgebPTrZAwcrE3FLnAuEqeGGC1otxsT0eBZlIlw4qwuZeL3AiAdoXpTmcsd3I17HL1DZlEVsTUsMvdl/RgRVmqknMnAKwIO+BMROBo2FkX4MHv8RbJV5f/p7gEIpjs/7fdsOsqvvneNbLIn0v/UU/fgUitgLnZR8Y72jAjunf3H5UTnugfaNa/FRFhuvnCQVeLvnh/jWzgXDw77xMDwY9n7AZ2tLV7N0PYZwaYtjdMYNsVgeDa3i7C8ZlhyO8FMSMCMCMCMCMCMCMCMCMCMCMCMCMCMAMBaiSwIQLwMu/65C+QwEXNdXEitMACTuGGBXkk8LBBnj7KULWkH5Ec5mMXn6ozd4pH9TTUcfyvSLCKQ/4U/tbrgGd0g2Q2ZA81+mE/eKoFwKmeOICeBCtg9Acna2850lzlApwpWSKhk3gzPxdPBy+2tCKcdf+Svj2EzqBiq2PchLP9msbhzhWSWVG7wSHOw4H1BOxoxuECXCh3Qhupj/wdwQctu6FahA0fPuWRkBQPsWwVfOCEvbt8plL2yZlUVxZIiENN1VdT0z8N39jrolABAPICDh8WISJR04Wtqq0wvQ+7OJIAzeAIdJzC3TgIGol6Px+HW2s85lXQ0VX21Ij3YryfngM5iwwUtnO8AwAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Use this Kommo template to easily add a Website chat button. Visitors can connect with your business using their preferred messaging channel, and you can manage all conversations within Kommo.",
  "categories": [
    "CHAT",
    "LEAD_GENERATION",
    "SALES"
  ],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "id",
    "displayName": "Button installation key",
    "simpleValueType": true,
    "help": "1. Go to your Kommo account \u003e Leads \u003e Automate.\n2. At the bottom left, click Add source, and select Website chat button.\n3. In the Website chat button setup page, click the Installation tab.\n3. Open the Install it yourself using Google Tag Manager section and copy the Button installation key from the field below."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// require relevant API
const setInWindow = require('setInWindow');
const log = require('logToConsole');
const injectScript = require('injectScript');

// capture values of template fields
const button_id = data.id;

//button settings
const stringParser = (str) => {
  const parts = str ? str.split(',') : '';

  if (parts.length === 3) {
    return {
      'id': parts[0],
      'hash': parts[1],
      'locale': parts[2],
      'inline': false,
      'setMeta':function(p){log(p);}
    };
  } else {
    // return empty object
    return {};
  }
};

const crm_plugin = stringParser(button_id);

setInWindow('crm_plugin', crm_plugin);
setInWindow('crmPlugin', function(){(crm_plugin.q=crm_plugin.q||[]).push(arguments);});

// Call data.gtmOnSuccess when the tag is finished.
injectScript('https://gso.kommo.com/js/button.js', data.gtmOnSuccess);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://gso.kommo.com/js/button.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "crmPlugin"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "crm_plugin"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 17.01.2024, 08:59:31


